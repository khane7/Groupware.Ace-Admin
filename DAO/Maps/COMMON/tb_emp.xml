<?xml version="1.0" encoding="utf-8" ?>

<sqlMap namespace="EMP" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >

	<statements>

		<select id="EMP.select_emp_list" resultClass="CEmp" parameterClass="System.Collections.Specialized.HybridDictionary">
			SELECT 
				A.*,
				B.*,
				(SELECT tree_key FROM tb_code WHERE tree_code = B.company_cd) AS company_name,
				(SELECT tree_key FROM tb_code WHERE tree_code = B.part_cd) AS part_name,
				(SELECT tree_key FROM tb_code WHERE tree_code = B.department_cd) AS department_name,
				(SELECT tree_key FROM tb_code WHERE tree_code = B.position_cd) AS position_name
			FROM
				tb_emp AS A
				LEFT JOIN     tb_emp_detail AS B ON A.emp_no = B.emp_no
			<dynamic prepend="WHERE">
				<isNotEmpty prepend="AND" property="search_text" >
					A.user_id LIKE '%#search_text#%' OR A.passwd LIKE '%#search_text#%' OR A.user_name LIKE '%#search_text#%'
				</isNotEmpty>
			</dynamic>
		</select>

		<select id="EMP.select_emp" resultClass="CEmp" parameterClass="System.Collections.Specialized.HybridDictionary">
			SELECT 
				A.*,
				B.*,
				(SELECT tree_key FROM tb_code WHERE tree_code = B.company_cd) AS company_name,
				(SELECT tree_key FROM tb_code WHERE tree_code = B.part_cd) AS part_name,
				(SELECT tree_key FROM tb_code WHERE tree_code = B.department_cd) AS department_name,
				(SELECT tree_key FROM tb_code WHERE tree_code = B.position_cd) AS position_name
			FROM
				tb_emp AS A
				LEFT JOIN     tb_emp_detail AS B ON A.emp_no = B.emp_no
			<dynamic prepend="WHERE">
				<isNotNull prepend="AND" property="idx">
					A.idx = #idx#
				</isNotNull>
				<isNotNull prepend="AND" property="id">
					A.id = #id#
					<isNotNull prepend="AND" property="passwd">
						A.passwd = #passwd#
					</isNotNull>
				</isNotNull>
				<isNotNull prepend="AND" property="emp_no">
					A.emp_no = #emp_no#
					<isNotNull prepend="AND" property="passwd">
						A.passwd = #passwd#
					</isNotNull>
				</isNotNull>
			</dynamic>
		</select>

		<insert id="EMP.insert_emp" parameterClass="CEmp">
			INSERT INTO
			tb_emp
			(
				id,
				name,
				passwd,
				email,
				reg_date,
				mod_date,
				is_used,
				is_admin
			)
			VALUES
			(
				#id#,
				#name#,
				#passwd#,
				#email#,
				#reg_date#,
				#mod_date#,
				#is_used#,
				#is_admin#
			)
		</insert>

		<update id="EMP.update_emp" parameterClass="CEmp">
			UPDATE
				tb_emp
			SET
				name = #name#,
				passwd = #passwd#,
				email = #email#,
				reg_date = #reg_date#,
				mod_date = #mod_date#,
				is_used = #is_used#,
				is_admin = #is_admin#
			WHERE
				idx = #idx#
		</update>

		<delete id="EMP.delete_emp" parameterClass="System.Int32">
			DELETE
			FROM
				tb_emp
			WHERE
				idx = #idx#
		</delete>
		
	</statements>
</sqlMap>